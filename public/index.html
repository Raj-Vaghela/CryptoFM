<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto FM - Cryptocurrency Radio</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <!-- Load fallback audio data first -->
  <script src="/offline-mp3.js"></script>
  <!-- Debug script with inline script as fallback -->
  <script src="/debug.js"></script>
  <script>
    // Inline debugging in case the external debug.js fails to load
    if (typeof CryptoFMDebug === 'undefined') {
      console.log('Creating inline debug helper');
      window.CryptoFMDebug = {
        testAudio: function(url) {
          // If offline-mp3.js is loaded, try that first
          if (window.playFallbackBeep) {
            console.log('Testing with built-in fallback audio');
            window.playFallbackBeep();
          }
          
          const audioUrl = url || 'https://storage.googleapis.com/cloud-samples-data/speech/brooklyn_bridge.mp3';
          console.log('Testing audio playback:', audioUrl);
          
          const audio = new Audio(audioUrl);
          audio.volume = 0.5;
          
          audio.addEventListener('canplaythrough', () => console.log('‚úÖ Audio can play through'));
          audio.addEventListener('playing', () => console.log('‚úÖ Audio started playing'));
          audio.addEventListener('error', (e) => console.error('‚ùå Audio error:', e));
          
          audio.play()
            .then(() => console.log('‚úÖ Audio play command accepted'))
            .catch(err => console.error('‚ùå Audio play rejected:', err.message));
          
          return audio;
        },
        
        testEndpoint: function(endpoint) {
          console.log('Testing API endpoint:', endpoint);
          
          return fetch('/api/' + endpoint)
            .then(res => res.json())
            .then(data => {
              console.log('‚úÖ API response:', data);
              return data;
            })
            .catch(err => {
              console.error('‚ùå API error:', err);
              return null;
            });
        },
        
        runTests: function() {
          console.log('üîç Running all tests...');
          this.testEndpoint('status');
          this.testEndpoint('next-segment')
            .then(data => {
              if (data && data.audioUrl) {
                console.log('üîä Testing audio from API response');
                this.testAudio(data.audioUrl);
              }
            });
          this.testAudio();
        }
      };
      console.log('Inline debug helper ready');
    }
  </script>
</head>
<body>
  <div class="container">
    <header class="text-center py-3">
      <h1 class="vintage-text">CRYPTO FM</h1>
      <p class="tagline">Your source for cryptocurrency updates</p>
    </header>
    
    <div class="radio-container">
      <div class="speaker-grille"></div>
      
      <div class="radio-display">
        <div class="display-content">
          <div class="status-bar">
            <span class="current-status">‚ö†Ô∏è Not Connected</span>
            <span class="signal-strength">
              <i class="fas fa-signal"></i>
            </span>
          </div>
          <div class="transcript-container" style="display: none;">
            <p id="currentTranscript">Loading crypto news...</p>
          </div>
        </div>
      </div>
      
      <div class="controls">
        <div class="volume-control">
          <div class="slider-track">
            <div id="volumeHandle" class="slider-handle"></div>
          </div>
          <span class="volume-label">VOLUME</span>
        </div>
        
        <div class="controls-info">
          <p><i class="fas fa-info-circle me-2"></i>Waiting for broadcast to begin...</p>
        </div>
      </div>
    </div>
    
    <div class="ticker-container">
      <div id="tickerTape" class="ticker-content">
        Bitcoin $64,200 ‚Üë 3.5% ‚Ä¢ Ethereum $3,100 ‚Üë 2.1% ‚Ä¢ Solana $155.50 ‚Üë 7.0% ‚Ä¢ Chainlink $14.25 ‚Üë 1.2% ‚Ä¢ Ripple $0.52 ‚Üì 0.8% ‚Ä¢ Cardano $0.45 ‚Üë 3.2% ‚Ä¢
      </div>
    </div>
    
    <audio id="audioPlayer" style="display:none;"></audio>
  </div>
  
  <script src="app.js"></script>
</body>
</html>